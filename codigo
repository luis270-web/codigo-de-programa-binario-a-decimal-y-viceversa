// Importo JOptionPane y otros para poder armar mis propias ventanitas con validación
import javax.swing.JOptionPane;
import javax.swing.JTextField;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;

public class Convertidor {

    public static void main(String[] args) {

        // 1. Texto del menú principal del programa
        //Armamos el texto del menú que se va a mostrar en la ventanita
        String textoMenu = "--- CONVERSOR DE NÚMEROS ---\n"
                + "1. Convertir Decimal a Binario\n"
                + "2. Convertir Binario a Decimal\n"
                + "Elige una opción (1 o 2):";

        // Variable donde voy a guardar la opción ya como número
        int opcionMenu = -1;

        // Este ciclo se repite mientras NO elija 1 ni 2
        while (opcionMenu != 1 && opcionMenu != 2) {

            // Ventanita con JTextField que solo acepta números
            String opcionEscrita = pedirSoloNumeros(
                    "Menú principal",   // Título de la ventana
                    textoMenu           // Mensaje que quiero mostrar
            );

            // Si el usuario cancela, termino el programa
            if (opcionEscrita == null) {
                return;
            }

            // Si dio OK pero no escribió nada, muestro mensaje y repito el menú
            if (opcionEscrita.isEmpty()) {
                JOptionPane.showMessageDialog(
                        null,
                        "Elige entre la opción 1 y 2.",
                        "Opción incorrecta",
                        JOptionPane.WARNING_MESSAGE
                );
                continue;   // Vuelve al inicio del while
            }

            // Convierto lo que escribió a número entero (solo trae dígitos)
            opcionMenu = Integer.parseInt(opcionEscrita);

            // Si la opción no es 1 ni 2, le aviso y se repite el ciclo
            if (opcionMenu != 1 && opcionMenu != 2) {
                JOptionPane.showMessageDialog(
                        null,
                        "Elige entre la opción 1 y 2.",
                        "Opción incorrecta",
                        JOptionPane.WARNING_MESSAGE
                );
            }
        }

        // 2. Switch para decidir qué conversión hacer
        switch (opcionMenu) {

            // CASO 1: DECIMAL A BINARIO
            case 1: {

                // Pedir DECIMAL obligatoriamente
                String textoDecimal = "";
                while (textoDecimal.isEmpty()) {

                    textoDecimal = pedirSoloNumeros(
                            "Decimal a Binario",
                            "Ingresa un número decimal (ej. 10):"
                    );

                    // Si cancela, salgo del programa
                    if (textoDecimal == null) {
                        return;
                    }

                    // Si viene vacío, aviso y repito el while
                    if (textoDecimal.isEmpty()) {
                        JOptionPane.showMessageDialog(
                                null,
                                "No puedes dejar vacío, ingresa un número decimal.",
                                "Dato faltante",
                                JOptionPane.WARNING_MESSAGE
                        );
                    }
                }

                // Convierto el texto a número entero 
                int numeroDecimalUsuario = Integer.parseInt(textoDecimal);

                // Validación extra por si quiero evitar negativos
                if (numeroDecimalUsuario < 0) {
                    JOptionPane.showMessageDialog(
                            null,
                            "Por favor ingresa solo números positivos.",
                            "Número no válido",
                            JOptionPane.WARNING_MESSAGE
                    );
                    return;
                }

                // String donde voy a ir armando el binario final
                String binarioFinal = "";

                // Variable temporal para ir dividiendo sin perder el original
                int numeroTemporal = numeroDecimalUsuario;

                // Caso especial: si el número es 0, el binario es "0"
                if (numeroTemporal == 0) {
                    binarioFinal = "0";
                } else {
                    // Ciclo: mientras el número sea mayor que 0 lo voy dividiendo entre 2
                    while (numeroTemporal > 0) {

                        // Saco el residuo de dividir entre 2 (me da 0 o 1)
                        int residuoDivision = numeroTemporal % 2;

                        // Voy agregando el residuo al INICIO del String
                        binarioFinal = residuoDivision + binarioFinal;

                        // Divido el número entre 2 para la siguiente vuelta del ciclo
                        numeroTemporal = numeroTemporal / 2;
                    }
                }

                // Muestro el resultado en una ventanita
                JOptionPane.showMessageDialog(
                        null,
                        "El número " + numeroDecimalUsuario + " en binario es: " + binarioFinal,
                        "Resultado Decimal a Binario",
                        JOptionPane.INFORMATION_MESSAGE
                );

                break;
            }

            // CASO 2: BINARIO A DECIMAL
            case 2: {

                // Pedir BINARIO obligatoriamente (solo 0 y 1)
                String textoBinario = "";
                while (textoBinario.isEmpty()) {

                    textoBinario = pedirSoloBinarios(
                            "Binario a Decimal",
                            "Ingresa un número binario (solo 0 y 1, ej. 101):"
                    );

                    // Si cancela, salgo del programa
                    if (textoBinario == null) {
                        return;
                    }

                    // Si viene vacío, aviso y repito el while
                    if (textoBinario.isEmpty()) {
                        JOptionPane.showMessageDialog(
                                null,
                                "No puedes dejar vacío, ingresa un número binario.",
                                "Dato faltante",
                                JOptionPane.WARNING_MESSAGE
                        );
                    }
                }

                // Convierto el binario que escribió el usuario a int
                int numeroBinarioUsuario = Integer.parseInt(textoBinario);

                // Variable donde voy a ir acumulando el resultado decimal
                int decimalCalculado = 0;

                // Esta variable representa la potencia de 2 (1, 2, 4, 8, 16, ...)
                int baseActual = 1;

                // Copia del binario original para irlo "desarmando" sin perder el valor original
                int copiaBinaria = numeroBinarioUsuario;

                // Ciclo: mientras todavía queden dígitos en el número binario
                while (copiaBinaria > 0) {

                    // Saco el último dígito de la derecha (0 o 1) usando módulo 10
                    int ultimoDigitoDerecha = copiaBinaria % 10;

                    // Sumo al resultado: dígito * la base actual (1, 2, 4, 8, etc)
                    decimalCalculado = decimalCalculado + (ultimoDigitoDerecha * baseActual);

                    // Quito el último dígito al número binario (básicamente recorro hacia la izquierda)
                    copiaBinaria = copiaBinaria / 10;

                    // Multiplico la base por 2 para la siguiente posición (siguiente potencia de 2)
                    baseActual = baseActual * 2;
                }

                // Muestro el resultado ya convertido a decimal
                JOptionPane.showMessageDialog(
                        null,
                        "El número binario " + numeroBinarioUsuario + " en decimal es: " + decimalCalculado,
                        "Resultado Binario a Decimal",
                        JOptionPane.INFORMATION_MESSAGE
                );

                break;
            }
        }
    }

    
    // Ventanita que SOLO acepta dígitos 0-9 (menú y decimal)
    private static String pedirSoloNumeros(String tituloVentana, String mensajeVentana) {

        // Creo el campo de texto donde el usuario va a escribir
        JTextField campoTexto = new JTextField();

        // Le agrego un KeyListener para bloquear cualquier cosa que no sea número
        // y también bloquear cuando ya tenga 9 dígitos
        campoTexto.addKeyListener(new KeyAdapter() {
            @Override
            public void keyTyped(KeyEvent e) {
                char tecla = e.getKeyChar();

                // Dejo pasar Backspace para que sí pueda borrar
                if (tecla == '\b') {
                    return;
                }

                // Si la tecla no es un dígito (0-9), entonces no la dejo escribir
                if (!Character.isDigit(tecla)) {
                    e.consume(); // Cancelo la tecla
                    return;
                }

                // Si ya hay 9 dígitos escritos, ya no dejo escribir más
                if (campoTexto.getText().length() >= 9) {
                    e.consume(); // Bloqueo el siguiente carácter
                }
            }
        });

        // Armo la ventana de confirmación con mi mensaje y el campo de texto
        int opcion = JOptionPane.showConfirmDialog(
                null,
                new Object[]{mensajeVentana, campoTexto}, // Muestro texto arriba y campo abajo
                tituloVentana,
                JOptionPane.OK_CANCEL_OPTION,
                JOptionPane.QUESTION_MESSAGE
        );

        // Si el usuario le dio en "Cancelar" o cerró la ventana
        if (opcion != JOptionPane.OK_OPTION) {
            return null;
        }

        // Tomo el texto que escribió el usuario
        String textoIngresado = campoTexto.getText();

        if (textoIngresado == null) {
            return null;
        }

        // Regreso el texto 
        return textoIngresado.trim();
    }

   
    // Ventanita que SOLO acepta 0 y 1 (para binarios)
   
    private static String pedirSoloBinarios(String tituloVentana, String mensajeVentana) {

        JTextField campoTexto = new JTextField();

        campoTexto.addKeyListener(new KeyAdapter() {
            @Override
            public void keyTyped(KeyEvent e) {
                char tecla = e.getKeyChar();

                // Dejo pasar Backspace para que sí pueda borrar
                if (tecla == '\b') {
                    return;
                }

                // Solo permito '0' y '1'
                if (tecla != '0' && tecla != '1') {
                    e.consume(); // Cancelo la tecla
                    return;
                }

                // Limito a 9 caracteres máximo
                if (campoTexto.getText().length() >= 9) {
                    e.consume();
                }
            }
        });

        int opcion = JOptionPane.showConfirmDialog(
                null,
                new Object[]{mensajeVentana, campoTexto},
                tituloVentana,
                JOptionPane.OK_CANCEL_OPTION,
                JOptionPane.QUESTION_MESSAGE
        );

        if (opcion != JOptionPane.OK_OPTION) {
            return null;
        }

        String textoIngresado = campoTexto.getText();

        if (textoIngresado == null) {
            return null;
        }

        return textoIngresado.trim();
    }
}